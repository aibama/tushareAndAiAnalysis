将接口
/api/rank涉及的个股回撤，或者反弹的逻辑改成用pandas实现的，这样速度会更快
算法逻辑
定义区间：确定计算的时间窗口（如过去N日）。
计算滚动最高点：对于每个交易日，计算从窗口起始日到当前日的最高收盘价（即历史峰值）。
计算回撤：当前收盘价相对于滚动最高点的跌幅 = (滚动最高点 - 当前收盘价) / 滚动最高点。
最大回撤：在窗口内取所有回撤值的最大值。

代码示例：
import pandas as pd

def calculate_max_drawdown(df, window=252):
    # 计算滚动最高点（窗口内从起始到当前的最大值）
    rolling_max = df['close'].rolling(window, min_periods=1).max()
    
    # 计算每日回撤：(滚动最高点 - 当前收盘价) / 滚动最高点
    drawdown = (rolling_max - df['close']) / rolling_max
    
    # 计算窗口内的最大回撤
    max_drawdown = drawdown.rolling(window, min_periods=1).max()
    
    return max_drawdown

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

2026-02-15 08:05:45,782 - PatternAnalysis.api_service - INFO - [1/56] 开始处理批次...
2026-02-15 08:05:45,782 - PatternAnalysis.api_service - INFO - [1/56] 正在获取 100 只股票数据...
2026-02-15 08:09:48,159 - PatternAnalysis.api_service - INFO - [1/56] 获取完成，有效数据: 100 只
2026-02-15 08:09:48,232 - PatternAnalysis.api_service - INFO - [1/56] 批次处理完成，耗时: 242.45秒，本批有效结果: 77
2026-02-15 08:09:48,232 - PatternAnalysis.api_service - INFO - [2/56] 开始处理批次...
2026-02-15 08:09:48,232 - PatternAnalysis.api_service - INFO - [2/56] 正在获取 100 只股票数据...   从日志上可以看到一个批次的数据就需要6分钟，将这里面的逻辑改成先快速返回涨跌幅的排名，个股的回撤或者反弹通过异步的方式刷到缓存中，算出来才通过同样的接口返回


-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

_compute_period_return_only：
这个函数用于计算指定时间段内的股票的收益率。但是用代码实现太慢了，从真正落地实测来看，2026-02-15 08:36:59,307 - PatternAnalysis.api_service - INFO - 阶段1：开始快速计算涨跌幅...；用了6分钟，都没有输出，将这个逻辑通过sql实现（应该就不需要多线程），应该很快就可以返回。


